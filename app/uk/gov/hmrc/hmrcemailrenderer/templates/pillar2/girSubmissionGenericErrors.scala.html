@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.libs.json.{ Json, JsObject }
@import uk.gov.hmrc.hmrcemailrenderer.templates.pillar2.Pillar2DateTimes.*

@(params: Map[String, Any])

@errorList = @{
    params("errors") match {
        case errors: String => Json.parse(errors).as[List[JsObject]]
        case errors: Seq[_] => errors.asInstanceOf[Seq[Map[String, String]]].map(m => Json.toJson(m).as[JsObject])
        case _ => List()
    }
}

@uk.gov.hmrc.hmrcemailrenderer.templates.helpers.html.template_main(params, "Errors identified in GloBE Information Return (GIR)") {

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">Pillar 2 ID: @{params("pillar2Id")}</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">GIR Reference ID: @{params("referenceId")}</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">Accounting period: @{ukAllNumericDateToUserFacing(params("accountingPeriodStart").toString)} to @{ukAllNumericDateToUserFacing(params("accountingPeriodEnd").toString)}</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">Received: @{toTwelveHourUserFacing(params("submissionTime").toString)} on @{ukAllNumericDateToUserFacing(params("submissionDate").toString)}</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">We have processed your GIR submission and identified the errors in the table below.</p>

<h2 style="font-size: 20px; margin: 0 0 15px 0;">What you need to do next</h2>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">You must correct these errors and re-submit your return <b>before your submission deadline date</b>.</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">You may be charged penalties if you submit a return after your deadline date.</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">You should contact your software provider if you need further guidance on how to correct these errors.</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">Thank you.</p>

<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 5px 0;">HM Revenue and Customs</p>
<p style="font-size: 20px; line-height: 1.315789474; margin: 0 0 30px 0;">Customer Compliance Group</p>

<table border="1" cellpadding="5" cellspacing="0">
    <thead>
    <tr>
        <td>Error Code</td>
        <td>Description</td>
        <td>DocRefId in Error</td>
        <td>Count</td>
    </tr>
    </thead>
    <tbody>
    @for(error <- errorList) {
    <tr>
        <td>@{(error \ "errorCode").as[String]}</td>
        <td>@{(error \ "description").as[String]}</td>
        <td>@{(error \ "docRefIds").asOpt[String].getOrElse("")}</td>
        <td>@{(error \ "count").as[String]}</td>
    </tr>
    }
    </tbody>
</table>

}
