@*
* Copyright 2022 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@import play.api.libs.json.{JsArray, JsDefined, JsLookupResult, JsObject, JsUndefined, JsValue, Json, JsBoolean}

@(params: Map[String, Any])

@allItems = @{params("f2fPaymentItemsForEmailSuccessful") match {
case items:String => Json.parse(items).as[List[JsObject]]
case _ => List()
}}

@itemList = @{ allItems.map( item => {

    val taxType: String = (item \ "taxType").as[String]
    val amount: String = (item \ "amount").as[String]
    val transactionFee: String = (item \ "transactionFee").as[String]
    val transactionNumber = (item \ "transactionNumber").as[String]
    val applicationId = (item \ "applicationId").as[String]
    val panSequence = (item \ "panSequence").as[String]
    val merchantId = (item \ "merchantId").as[String]
    val terminalId = (item \ "terminalId").as[String]
    val cardVerificationMethod = (item \ "cardVerificationMethod").as[String]
    val authorisation = (item \ "authorisation").as[String]
    val transactionSource = (item \ "transactionSource").as[String]
    val time = (item \ "time").as[String]
    val transactionType = (item \ "transactionType").as[String]
    (taxType, amount, transactionFee, transactionNumber, applicationId, panSequence, merchantId, terminalId, cardVerificationMethod, authorisation, transactionSource, time, transactionType)
    })
}

@singleItem = @{itemList.size == 1}

@uk.gov.hmrc.hmrcemailrenderer.templates.helpers.html.template_main(params, "HMRC payment confirmation") {

<p style="font-size: 19px;line-height: 1.315789474;margin: 0 0 30px 0;">Dear Customer</p>


<p style="margin: 0 0 30px; font-size: 19px;">Your payment has been received by HMRC.</p>


<table width="100%" cellspacing="0" cellpadding="2px" style="text-align:left;font-size: 19px;">
    <tbody>
    <tr>
        <th>Date</th>
        <td>@params("dateOfPayment")</td>
    </tr>
    @for((taxType, amount, transactionFee, transactionNumber, applicationId, panSequence, merchantId, terminalId, cardVerificationMethod, authorisation, transactionSource, time, transactionType) <- itemList) {
    <tr>
        <th>Tax</th>
        <td>@taxType</td>
    </tr>
    <tr>
        <th>Payment reference</th>
        <td>@transactionNumber</td>
    </tr>
    }
    <tr>
        <th>Tax Reference</th>
        <td>@params("transactionReference")</td>
    </tr>
    @for((taxType, amount, transactionFee, transactionNumber, applicationId, panSequence, merchantId, terminalId, cardVerificationMethod, authorisation, transactionSource, time, transactionType) <- itemList) {
    <tr>
        <th>Amount</th>
        <td>@amount</td>
    </tr>
    <tr>
        <th>Card fee</th>
        <td>@transactionFee</td>
    </tr>
    }
    <tr>
        <th>Total paid</th>
        <td>Â£@params("totalAmountPaid")</td>
    </tr>
    <tr>
        <th>Card type</th>
        <td>Paid with @params("cardType")</td>
    </tr>
    <tr>
        <th>Card ending </th>
        <td>ending in @params("cardNumber")</td>
    </tr>
    @for((taxType, amount, transactionFee, transactionNumber, applicationId, panSequence, merchantId, terminalId, cardVerificationMethod, authorisation, transactionSource, time, transactionType) <- itemList) {
    <tr>
        <th>Application ID</th>
        <td>@applicationId</td>
    </tr>
    <tr>
        <th>PAN sequence</th>
        <td>@panSequence</td>
    </tr>
    <tr>
        <th>Merchant ID</th>
        <td>@merchantId</td>
    </tr>
    <tr>
        <th>Terminal ID</th>
        <td>@terminalId</td>
    </tr>
    <tr>
        <th>Card verification method</th>
        <td>@cardVerificationMethod</td>
    </tr>
    <tr>
        <th>Authorisation</th>
        <td>@authorisation</td>
    </tr>
    <tr>
        <th>Transaction source</th>
        <td>@transactionSource</td>
    </tr>
    }
    <tr>
        <th>Date</th>
        <td>@params("dateOfPayment")</td>
    </tr>
    @for((taxType, amount, transactionFee, transactionNumber, applicationId, panSequence, merchantId, terminalId, cardVerificationMethod, authorisation, transactionSource, time, transactionType) <- itemList) {
    <tr>
        <th>Time</th>
        <td>@time</td>
    </tr>
    <tr>
        <th>Transaction type</th>
        <td>@transactionType</td>
    </tr>
    }



    </tbody>
</table>


<p style="margin: 30px 0 30px; font-size: 19px;">If you have an online tax account your payment will take 3 to 5 days to show in your account.</p>

<h2  style="margin: 0 0 30px; font-size: 19px;">Why you got this email</h2>

<p style="margin: 0 0 30px; font-size: 19px;">You chose to receive payment confirmation by email.</p>

<p style="margin: 0 0 30px; font-size: 19px;">FFrom HM Revenue and Customs</p>

}
