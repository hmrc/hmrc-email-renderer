@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.libs.json.{JsArray, JsDefined, JsLookupResult, JsObject, JsUndefined, JsValue, Json}
@import scala.math.BigDecimal.RoundingMode

@(params: Map[String, Any])

@allItems = @{params("AllITEMS") match {
case items:String => Json.parse(items).as[List[JsObject]]
case _ => List()
}}

@isZeroCondition = @{params("TOTAL").toString().equalsIgnoreCase("£ 0.00")}

@pageHeaderNormal = @{"You have paid the tax and duty you owe for your goods"}
@pageHeaderZero = @{"You have declared your goods"}

@pageHeader = @{if(isZeroCondition)pageHeaderZero else pageHeaderNormal}

@itemList = @{ allItems.map( item => {
val commodityDescription = (item \ "commodityDescription").as[String]
val volume = item \ "volume"
val quantity = item \ "quantity"
val volOrQuantity = if (quantity.isDefined) quantity.as[String]  else (volume.as[String] + " litres")
val itemDesc = s"$volOrQuantity $commodityDescription"

val goodsValue = (item \ "goodsValue").as[String]
val valueCurrency = (item \ "valueCurrency").as[String]
val localValue = s"$goodsValue $valueCurrency"

val originCountry = (item \ "originCountry").as[String]

val exciseGBP = (item \ "exciseGBP").as[String]
val customsGBP = (item \ "customsGBP").as[String]
val vatGBP = (item \ "vatGBP").as[String]
val itemTaxRaw = BigDecimal(exciseGBP) + BigDecimal(customsGBP) + BigDecimal(vatGBP)
val itemTax = itemTaxRaw.setScale(2,RoundingMode.apply(2))


(itemDesc,localValue,originCountry,itemTax)
})
}

@uk.gov.hmrc.hmrcemailrenderer.templates.helpers.html.template_main(params, pageHeader) {


<p>When you arrive in the UK, go to the green 'nothing to declare' channel if these are the only items you are
    declaring. If asked, show your receipt on your mobile phone or tablet to a member of Border Force, or provide your
    reference number.</p>

<h2>Your details</h2>

<table width="100%" cellspacing="0px" cellpadding="2px" style="text-align:left;font-size: 19px;c">
    <tbody>
    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Name</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("NAME")</td>
    </tr>

    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Place of arrival in UK</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("PLACEOFARRIVAL")</td>
    </tr>

    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Date of arrival</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("DATEOFARRIVAL")</td>
    </tr>

    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Time of arrival</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("TIMEOFARRIVAL")</td>
    </tr>
    @if(!isZeroCondition) {
    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Date of payment</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("DATE")</td>
    </tr>
    }
    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Reference number</th>
        <td style="border-bottom: 1px solid #bfc1c3">@params("REFERENCE")</td>
    </tr>

    <tr>
        <th style="border-bottom: 1px solid #bfc1c3">Amount paid</th>
        <th style="border-bottom: 1px solid #bfc1c3">@params("TOTAL")</th>
    </tr>
    </tbody>
</table>

<h2>Items declared</h2>

<table width="100%" cellspacing="4px" cellpadding="2px" style="text-align:left;font-size: 19px;">
    <thead>
    <tr role="row">
        <th scope="col">Item</th>
        <th scope="col">Price</th>
        <th scope="col">Purchased in</th>
        <th style="text-align:right;" class="numeric" scope="col">
            <span class="table-25">Tax paid</span>
        </th>
    </tr>
    </thead>
    <tbody>
    @for((itemDesc,localValue,originCountry,itemTax) <- itemList) {
    <tr role="row">
        <td style="border-bottom: 1px solid #bfc1c3">@itemDesc</td>
        <td style="border-bottom: 1px solid #bfc1c3">@localValue</td>
        <td style="border-bottom: 1px solid #bfc1c3">@originCountry</td>
        <td style="text-align:right;border-bottom: 1px solid #bfc1c3">£ @itemTax</td>
    </tr>
    }
    </tbody>
</table>

<div style="border-bottom: 1px solid #bfc1c3;display: flex;font-weight: 700;justify-content: space-between;padding: .63158em 0 .47368em 0;">
    <span style="font-size: 20px;font-weight: 700">Total</span>
    <span style="text-align: right;font-size: 20px;font-weight: 700">@params("TOTAL")</span>
</div>

<h2>Payment breakdown</h2>
<table width="100%" cellspacing="4px" cellpadding="2px" style="text-align:left;font-size: 19px;">
    <thead>
    <tr role="row">
        <th style="border-bottom: 1px solid #bfc1c3">Type of tax or duty</th>
        <th style="text-align:right;border-bottom: 1px solid #bfc1c3">
            <span style="text-align:right">Amount paid</span></th>
    </tr>
    </thead>

    <tbody>
    <tr>
        <td style="border-bottom: 1px solid #bfc1c3">Customs</td>
        <td style="text-align:right;border-bottom: 1px solid #bfc1c3">@params("TOTALCUSTOMSGBP")</td>
    </tr>

    <tr>
        <td style="border-bottom: 1px solid #bfc1c3">Excise</td>
        <td style="text-align:right;border-bottom: 1px solid #bfc1c3"> @params("TOTALEXCISEGBP")</td>
    </tr>

    <tr>
        <td style="border-bottom: 1px solid #bfc1c3">VAT</td>
        <td style="text-align:right;border-bottom: 1px solid #bfc1c3">@params("TOTALVATGBP")</td>
    </tr>
    </tbody>
</table>
<div style="border-bottom: 1px solid #bfc1c3;display: flex;font-weight: 700;justify-content: space-between;padding: .63158em 0 .47368em 0;">
    <span style="font-size: 20px;font-weight: 700">Total</span>
    <span style="text-align: right;font-size: 20px;font-weight: 700">@params("TOTAL")</span>
</div>
<p></p>
@if(isZeroCondition) {
<div class="panel panel-border-wide margin-top-30">Tax or duty was either not due on these goods or was paid when the
    goods were purchased.
</div>
}

<h2 class="heading-medium">Amending your declaration</h2>

<p>From February 2021, you will be able to use the online service to add goods to an existing declaration.</p>
<p>If you have goods to declare, go to the red 'goods to declare' channel or use the red-point phone at your arrival
    location.</p>
<p>If you need to remove goods from your declaration and request a refund, visit GOV.UK and search for 'HMRC customs
    debt'.</p>
<p>From HMRC Online Service for Passengers</p>

}
